<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MusicPlayer</title>
    <link rel="stylesheet" href="./test.css">
</head>

<body>
    <div id="app">
        <div class="app-search">
            <div class="app-logo">Pandora Box</div>
            <input type="text" @keyup.13='search' v-model='keyword'>
        </div>

        <div class="app-content">
            <div class="app-content-left">
                <ul v-on:click='findsongid($event)' class="songList" ref='start-songlist'>
                    <li v-for="(item, index) in songslist" v-bind:songid='item.id' v-bind:mvid='item.mvid'>
                        {{item.name}}
                    </li>
                </ul>
            </div>

            <div class="app-content-middle">
                <img src="./player_bar.png" alt="" ref='start-move' :class='[{move: move},{barstop: barstop}]'>
                <img :src='songImg' alt="">
                <img src="./disc.png" alt="" :class='[{discmove: discmove},{discstop: discstop}]'>
            </div>

            <div class="app-cotent-right">
                <ul>
                    <!-- <li v-for:(item, index) in commentlist>
                       
                    </li> -->
                </ul>
            </div>
        </div>

        <div class="app-bottom">
            <div class="app-bottom-left">
                <img :src="songImg" alt="">
                <div class="bottom-right">
                    <p class="song_name">{{songname}}</p>
                    <p class="song_singer">{{songartist}}</p>
                </div>
            </div>
            <div class="app-bottom-middle">
                <audio :src="songsrc" controls autoplay v-on:pause='stopanimate' v-on:play='startanimate'></audio>
            </div>
        </div>

        <!-- <video :src="mvsrc" controls></video> -->
    </div>

    <script src="./node_modules/axios/dist/axios.js"></script>
    <script src="./node_modules/vue/dist/vue.js"></script>
    <script>
        let vm = new Vue({
            el: '#app',
            data: {
                keyword: '热门',
                songslist: [],
                songsrc: '',
                mvsrc: '',
                songname: '',
                songartist: '',
                songImg: '',
                move: false,
                discmove: false,
                barstop: false,
                discstop: false,
                commentlist: []
            },
            created: function() {
                this.search(this.keyword)
            },
            // updated: function() {
            //     let songid = this.$refs['start-songlist'].children[0].attributes['songid'].value;
            //     let mvid = this.$refs['start-songlist'].children[0].attributes['mvid'].value;
            //     this.playsong(songid, mvid);
            // },
            methods: {
                search: function() {
                    axios.get('https://apimusic.linweiqin.com/search?keywords=' + this.keyword)
                        .then((response) => {
                            // console.log(response.data.result.songs);
                            this.renderUl(response.data.result.songs)
                        })
                        .catch((err) => {
                            console.log(err);
                        })
                },
                renderUl: function(data) {
                    this.songslist.length = 0;
                    data.forEach(element => {
                        this.songslist.push({
                            id: element.id,
                            name: element.name,
                            mvid: element.mvid
                        })
                    });
                },
                findsongid: function(event) {
                    let songId = event.target.attributes[0].value;
                    let mvid = event.target.attributes[1].value;
                    this.playsong(songId, mvid);
                },
                playsong(songId, mvid) {
                    axios.get('https://apimusic.linweiqin.com/song/url?id=' + songId)
                        .then((res) => {
                            let src = res.data.data[0].url;
                            this.songsrc = src

                            axios.get('https://apimusic.linweiqin.com/song/detail?ids=' + songId).then((res) => {
                                console.log(res.data.songs[0]);
                                this.songImg = res.data.songs[0].al.picUrl
                                this.songname = res.data.songs[0].name
                                this.songartist = res.data.songs[0].ar[0].name
                                this.move = true
                                this.discmove = true

                                axios.get('https://apimusic.linweiqin.com/comment/hot?type=0&id=' + songId).then((res) => {
                                    // console.log(res.data.hotComments)
                                    console.log(res);
                                })
                            })
                        })

                    if (mvid == 0) {
                        console.log('没有此歌曲的mv');
                    } else {
                        axios.get('https://apimusic.linweiqin.com/mv/url?id=' + mvid).then((res) => {
                            let src = res.data.data.url;
                            this.mvsrc = src
                        })
                    }
                },
                stopanimate: function() {
                    this.barstop = true;
                    this.discstop = true;
                },
                startanimate: function() {
                    this.move = true;
                    this.discmove = true;
                    this.barstop = false;
                    this.discstop = false;
                }
            }
        })
    </script>
</body>

</html>